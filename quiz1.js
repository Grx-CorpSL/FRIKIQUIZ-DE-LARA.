const preguntas = [
  // Bloque 1: preguntas 1 a 25
  {
    "pregunta": "¿Cuál es la unidad funcional del riñón?",
    "opciones": ["Glomérulo", "Nefrona", "Túbulo contorneado", "Asa de Henle"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué hormona produce el páncreas para reducir la glucosa en sangre?",
    "opciones": ["Glucagón", "Adrenalina", "Insulina", "Cortisol"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Dónde se produce la hematopoyesis (formación de células sanguíneas)?",
    "opciones": ["Hígado", "Riñón", "Médula ósea", "Bazo"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cuál es la principal función del intestino delgado?",
    "opciones": ["Absorber agua", "Absorber nutrientes", "Producir bilis", "Almacenar residuos"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Cuál es el cromosoma alterado en el síndrome de Down?",
    "opciones": ["21", "23", "18", "16"],
    "respuesta": 0
  },
  {
    "pregunta": "¿Qué tipo de articulación es la rodilla?",
    "opciones": ["Plana", "Enartrosis", "Bisagra", "Trocoide"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cuál es la función de las mitocondrias?",
    "opciones": ["Sintetizar proteínas", "Generar energía (ATP)", "Almacenar lípidos", "Controlar el ciclo celular"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué tipo de neuronas llevan la información al sistema nervioso central?",
    "opciones": ["Motoras", "Sensoriales", "Interneuronas", "Simpáticas"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Cuál es el grupo sanguíneo considerado donante universal?",
    "opciones": ["AB+", "O+", "O–", "A–"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué parte del cerebro controla el equilibrio?",
    "opciones": ["Cerebro", "Bulbo raquídeo", "Cerebelo", "Tálamo"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué componente transporta oxígeno en los glóbulos rojos?",
    "opciones": ["Glucosa", "Hemoglobina", "Colágeno", "Fibrina"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué tipo de músculo forma el corazón?",
    "opciones": ["Liso", "Esquelético", "Cardíaco", "Estriado"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué célula produce anticuerpos?",
    "opciones": ["Neurona", "Linfocito T", "Linfocito B", "Macrófago"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué vitamina favorece la absorción de calcio?",
    "opciones": ["Vitamina C", "Vitamina D", "Vitamina A", "Vitamina K"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué estructura filtra la sangre en el riñón?",
    "opciones": ["Nefrona", "Cápsula de Bowman", "Uréter", "Túbulo distal"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Dónde se encuentran los receptores del gusto?",
    "opciones": ["Laringe", "Faringe", "Papilas gustativas", "Amígdalas"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cuál es el órgano más grande del cuerpo humano?",
    "opciones": ["Pulmón", "Intestino", "Piel", "Hígado"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cómo se llama el pigmento que da color a la piel?",
    "opciones": ["Caroteno", "Bilirrubina", "Melanina", "Hemoglobina"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Dónde se almacenan los espermatozoides antes de salir?",
    "opciones": ["Vesícula seminal", "Conducto deferente", "Testículo", "Epidídimo"],
    "respuesta": 3
  },
  {
    "pregunta": "¿Qué parte del ojo regula la cantidad de luz que entra?",
    "opciones": ["Retina", "Pupila", "Cristalino", "Iris"],
    "respuesta": 3
  },
  {
    "pregunta": "¿Qué sistema se encarga de la defensa del organismo?",
    "opciones": ["Circulatorio", "Digestivo", "Inmunológico", "Excretor"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cuál de estas no es una célula del sistema inmunitario?",
    "opciones": ["Linfocito", "Neutrófilo", "Macrófago", "Eritrocito"],
    "respuesta": 3
  },
  {
    "pregunta": "¿Qué componente es esencial en las membranas celulares?",
    "opciones": ["Glucógeno", "ADN", "Colesterol", "Ácido láctico"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué enzima digestiva actúa en la saliva?",
    "opciones": ["Lipasa", "Amilasa", "Pepsina", "Maltasa"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Dónde se produce la digestión de las proteínas?",
    "opciones": ["Boca", "Estómago", "Hígado", "Intestino grueso"],
    "respuesta": 1
  }
];

// A continuación, el segundo bloque, con las preguntas 26 a 50:

preguntas.push(
  {
    "pregunta": "¿Qué glándula regula el metabolismo?",
    "opciones": ["Hipófisis", "Suprarrenal", "Tiroides", "Pineal"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué tipo de tejido recubre la superficie del cuerpo?",
    "opciones": ["Nervioso", "Muscular", "Epitelial", "Conectivo"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué célula lleva la información genética?",
    "opciones": ["Leucocito", "Neurona", "Espermatozoide", "Eritrocito"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué proteína permite la contracción muscular?",
    "opciones": ["Queratina", "Insulina", "Miosina", "Albumina"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Dónde se almacena la bilis?",
    "opciones": ["Hígado", "Vesícula biliar", "Páncreas", "Estómago"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué hormona estimula la ovulación?",
    "opciones": ["Progesterona", "LH", "FSH", "Oxitocina"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué parte del encéfalo controla la respiración?",
    "opciones": ["Cerebelo", "Hipotálamo", "Bulbo raquídeo", "Cuerpo calloso"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué gas se elimina principalmente en la respiración?",
    "opciones": ["Nitrógeno", "Dióxido de carbono", "Oxígeno", "Hidrógeno"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué tipo de célula transporta oxígeno?",
    "opciones": ["Neurona", "Plaqueta", "Eritrocito", "Leucocito"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué nombre recibe la pérdida de un alelo en un organismo?",
    "opciones": ["Mutación puntual", "Deleción", "Translocación", "Inversión"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué glándula segrega la hormona del crecimiento?",
    "opciones": ["Tiroides", "Suprarrenal", "Hipófisis", "Pineal"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué estructura conecta la madre con el feto?",
    "opciones": ["Útero", "Placenta", "Trompas de Falopio", "Cordón medular"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué órgano produce la orina?",
    "opciones": ["Vejiga", "Uréter", "Riñón", "Uretra"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Cuál es la función de los cilios en las vías respiratorias?",
    "opciones": ["Absorber oxígeno", "Secretar mucosa", "Mover el moco", "Filtrar gases"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué tipo de célula tiene núcleo?",
    "opciones": ["Bacteriana", "Procariota", "Eucariota", "Virus"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué nombre recibe el proceso de división celular en las células sexuales?",
    "opciones": ["Mitosis", "Meiosis", "Apoptosis", "Citocinesis"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué tipo de reproducción presenta el ser humano?",
    "opciones": ["Asexual", "Clonal", "Sexual", "Gemación"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué nombre recibe la pérdida total o parcial de una función corporal?",
    "opciones": ["Enfermedad", "Lesión", "Discapacidad", "Mutación"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué célula del sistema nervioso transmite impulsos?",
    "opciones": ["Neurona", "Glía", "Oligodendrocito", "Célula madre"],
    "respuesta": 0
  },
  {
    "pregunta": "¿Qué estructura permite la unión entre dos neuronas?",
    "opciones": ["Dendrita", "Axón", "Sinapsis", "Mielina"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué es el ADN?",
    "opciones": ["Un polisacárido", "Un lípido", "Un ácido nucleico", "Una enzima"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué nombre recibe el proceso de formación de gametos?",
    "opciones": ["Reproducción", "Fecundación", "Gametogénesis", "Clonación"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué sistema transporta hormonas y nutrientes?",
    "opciones": ["Excretor", "Circulatorio", "Respiratorio", "Nervioso"],
    "respuesta": 1
  },
  {
    "pregunta": "¿Qué parte del cuerpo humano contiene huesos más pequeños?",
    "opciones": ["Mano", "Pie", "Oído", "Nariz"],
    "respuesta": 2
  },
  {
    "pregunta": "¿Qué es un virus?",
    "opciones": ["Una célula sin núcleo", "Un organismo pluricelular", "Un ser vivo", "Un agente infeccioso acelular"],
    "respuesta": 3
  }
);
// VOZ: Configuración Web Speech API
const synth = window.speechSynthesis;
let voces = [];

function cargarVoces() {
  voces = synth.getVoices();
}

synth.onvoiceschanged = () => cargarVoces();

function elegirVoz() {
  const vozBR = voces.find(v => v.lang.toLowerCase().startsWith('pt-br'));
  const vozES = voces.find(v => v.lang.toLowerCase().startsWith('es'));
  return vozBR || vozES || voces[0];
}

function hablar(texto, callback) {
  if (!synth) {
    if (callback) callback();
    return;
  }
  const u = new SpeechSynthesisUtterance(texto);
  const v = elegirVoz();
  u.voice = v;
  u.lang = v.lang;
  u.rate = 0.9;
  u.pitch = 1.1;
  u.onstart = () => personaje.setAttribute("src", "talk.json");
  u.onend = () => {
    personaje.setAttribute("src", "idle.json");
    if (callback) callback();
  };
  synth.speak(u);
}

// VARIABLES
let indice = 0;
let puntuacion = 0;

// ELEMENTOS DOM
const preguntaTexto = document.getElementById("pregunta");
const opcionesContainer = document.getElementById("opciones");
const personaje = document.getElementById("personaje");
const resultadoContainer = document.getElementById("resultado");
const botonReiniciar = document.getElementById("reiniciar");
const botonEmpezar = document.getElementById("empezar");

// FUNCIONES PRINCIPALES
function mostrarPregunta() {
  botonReiniciar.style.display = "none";

  if (indice >= preguntas.length) {
    mostrarResultado();
    return;
  }

  const p = preguntas[indice];
  preguntaTexto.textContent = `${indice + 1}. ${p.pregunta}`;
  opcionesContainer.innerHTML = "";

  hablar(p.pregunta, () => {
    p.opciones.forEach((op, i) => {
      const btn = document.createElement("button");
      btn.textContent = `${String.fromCharCode(65 + i)}) ${op}`;
      btn.className = "opcion";
      btn.onclick = () => verificarRespuesta(i);
      opcionesContainer.appendChild(btn);
    });
  });
}

function verificarRespuesta(seleccion) {
  const p = preguntas[indice];
  const correcto = p.opciones[p.respuesta];
  const esCorrecto = seleccion === p.respuesta;
  const msg = esCorrecto ? frasesAcertadas() : frasesFalladas();

  hablar(msg, () => {
    if (esCorrecto) puntuacion++;
    indice++;
    mostrarPregunta();
  });
}

function frasesAcertadas() {
  const frases = [
    "¡Muy bien, doctorcito! ¡Vas que vuelas para el Nobel!",
    "¡Correcto! Hasta House estaría orgulloso.",
    "¡Sí señor! El bisturí no tiembla contigo.",
    "¡Perfecto! Has estudiado más que un residente sin vida social.",
    "¡Genial! ¿Estás seguro que no eres médico ya?"
  ];
  return frases[Math.floor(Math.random() * frases.length)];
}

function frasesFalladas() {
  const frases = [
    "¡Pero por el amor a Hipócrates! ¿Qué acabas de hacer?",
    "Eso no lo falla ni un zombi con bata... ¡Revisa tus apuntes!",
    "¿Estás seguro de que no estudiaste veterinaria por error?",
    "Ay madre... si esto fuera una operación, ya tendríamos denuncia.",
    "¡Incorrecto! Menos mal que esto es un juego y no un quirófano."
  ];
  return frases[Math.floor(Math.random() * frases.length)];
}

function mostrarResultado() {
  preguntaTexto.textContent = "¡FIN DEL QUIZ!";
  opcionesContainer.innerHTML = "";
  resultadoContainer.textContent = `Has acertado ${puntuacion} de ${preguntas.length} preguntas.`;

  if (puntuacion > 25) {
    hablar("¡Increíble! Has aprobado, a bailar como un mono feliz.", () => {
      personaje.setAttribute("src", "dancecon.json");

      const mono2 = document.createElement("lottie-player");
      mono2.setAttribute("src", "dancesin.json");
      mono2.setAttribute("autoplay", "");
      mono2.setAttribute("loop", "");
      mono2.style.width = "200px";
      mono2.style.height = "200px";
      resultadoContainer.appendChild(mono2);
    });
  } else {
    hablar("No has llegado al mínimo, vuelve a estudiar o te reviento los apuntes.");
    personaje.setAttribute("src", "idle.json");
  }

  botonReiniciar.style.display = "block";
}

function reiniciarQuiz() {
  indice = 0;
  puntuacion = 0;
  resultadoContainer.textContent = "";
  mostrarPregunta();
}

// ARRANQUE
window.onload = () => {
  cargarVoces();

  botonEmpezar.onclick = () => {
    botonEmpezar.style.display = "none";
    mostrarPregunta();
  };

  botonReiniciar.onclick = reiniciarQuiz;
};
